# ---
apiVersion: apps/v1
kind: Deployment
metadata:
  annotations:
    meta.helm.sh/release-name: internal-police-backend-service
    meta.helm.sh/release-namespace: default
  labels:
    app: internal-police-backend-service
    app.kubernetes.io/managed-by: Helm
  name: internal-police-backend-service
  namespace: itg
  resourceVersion: '21957604'
spec:
  progressDeadlineSeconds: 600
  replicas: 1
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app: internal-police-backend-service
  strategy:
    rollingUpdate:
      maxSurge: 25%
      maxUnavailable: 25%
    type: RollingUpdate
  template:
    metadata:
      annotations:
        kubectl.kubernetes.io/restartedAt: '2025-08-14T18:31:42+08:00'
      creationTimestamp: null
      labels:
        app: internal-police-backend-service
    spec:
      containers:
        - env:
            - name: LANG
              value: en_US.UTF-8
          image: 'yunweiimg.secxun.com/itg/internal-police-backend-service:298'
          imagePullPolicy: Always
          name: internal-police-backend-service
          resources:
            limits:
              cpu: '4'
              memory: 4Gi
            requests:
              cpu: 200m
              memory: 512Mi
          terminationMessagePath: /dev/termination-log
          terminationMessagePolicy: File
          volumeMounts:
            - mountPath: /tmp
              name: yth-log
            - mountPath: /data/storage
              name: yth-per
      dnsPolicy: ClusterFirst
      imagePullSecrets:
        - name: regcred
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: {}
      terminationGracePeriodSeconds: 30
      volumes:
        - hostPath:
            path: /data/logs
            type: Directory
          name: yth-log
        - hostPath:
            path: /data/storage
            type: Directory
          name: yth-per

# ---
apiVersion: v1
kind: Service
metadata:
  annotations:
    meta.helm.sh/release-name: internal-police-backend-service
    meta.helm.sh/release-namespace: default
  labels:
    app: internal-police-backend-service
    app.kubernetes.io/managed-by: Helm
  name: internal-police-backend-service
  namespace: itg
  resourceVersion: '1215481'
spec:
  clusterIP: 10.99.230.236
  clusterIPs:
    - 10.99.230.236
  externalTrafficPolicy: Cluster
  internalTrafficPolicy: Cluster
  ipFamilies:
    - IPv4
  ipFamilyPolicy: SingleStack
  ports:
    - nodePort: 32080
      port: 80
      protocol: TCP
      targetPort: 9501
  selector:
    app: internal-police-backend-service
  sessionAffinity: None
  type: NodePort

# ---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    meta.helm.sh/release-name: internal-police-backend-service
    meta.helm.sh/release-namespace: default
    nginx.ingress.kubernetes.io/proxy-body-size: 200M
    nginx.ingress.kubernetes.io/proxy-read-timeout: '300'
    nginx.ingress.kubernetes.io/rewrite-target: /$2
    nginx.org/location-snippets: |
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
  labels:
    app.kubernetes.io/managed-by: Helm
  name: internal-police-backend-service
  namespace: itg
  resourceVersion: '14880802'
spec:
  rules:
    - host: itg.secxun.cn
      http:
        paths:
          - backend:
              service:
                name: internal-police-backend-service
                port:
                  number: 80
            path: /internal-police-backend-service(/|$)(.*)
            pathType: ImplementationSpecific
          - backend:
              service:
                name: internal-police-wss-backend-service
                port:
                  number: 80
            path: /internal-police-wss-backend-service(/|$)(.*)
            pathType: ImplementationSpecific


